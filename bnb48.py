import time
import json
import requests

from typing import List
from transaction import AccCompound, SECRET_KEYS

URL = 'https://puissant-bsc.48.club'


class Bnb48():
    def __init__(self) -> None:
        self.url = URL
        self.acc = AccCompound(SECRET_KEYS['BNB48'][0])

    def send_puissant(self, txs: List, max_timestamp: int, tx_hashes:List=[]):
        # Define the JSON-RPC payload for the eth_sendPuissant request
        payload = {
            "jsonrpc": "2.0",
            "method": "eth_sendPuissant",
            "params": [
                {
                    "txs": txs,
                    "maxTimestamp": max_timestamp,
                    "acceptReverting": tx_hashes
                }
            ],
            "id": 1
        }

        headers = {
            'Content-Type': 'application/json'
        }

        # Send the JSON-RPC request to the RPC endpoint
        response = requests.post(self.url, headers=headers, data=json.dumps(payload), timeout=0.1).json()
        print(response)
        if "error" in response:
            return response['error']['code']

        # Print the response
        return 0

    def query_gas_price(self):
            # Define the JSON-RPC payload for the eth_sendPuissant request
        payload = {
            "jsonrpc": "2.0",
            "method": "eth_gasPrice",
            "id": 1
        }

        # Send the JSON-RPC request to the RPC endpoint
        response = requests.post(self.url, json=payload)
        res = response.json()
        print(res)
        result = res['result']

        # Print the response
        return int(result, 16) 


if __name__ == '__main__':
    bnb48 = Bnb48()
    # res = bnb48.query_gas_price()
    # print(res)


    txs = ['0xf864068512a05f20008255f094fc030e374112103c889d0c9b6dbe2b9c6fc9461480801ca0eaef68252b7eca0e5629e28b236c27dcb2b357aba9f5a452f342225e12a06390a0492d47d856bec9de2d469383b8e6550e3ffb69be6facc56f9761a6620fb1979b', '0xf9054e830a2d5c84b2d05e008307a12094fc3069296a691250ffdf21fe51340fdd415a76ed80b904e4c980753900000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000320000000000000000000000000000000000000000000000000000000000000040001000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000280000000000000000000000023c28d85ecdcf3060714c28f728feec10003306f04010c08020a0f0d070e06030509040b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000029d65bce8000000000000000000000000000000000000000000000000000000029d756c92500000000000000000000000000000000000000000000000000000029d8aee64000000000000000000000000000000000000000000000000000000029d8aee64000000000000000000000000000000000000000000000000000000029d9de2e7c00000000000000000000000000000000000000000000000000000029dac4551900000000000000000000000000000000000000000000000000000029dc13f6b800000000000000000000000000000000000000000000000000000029dc60f1c000000000000000000000000000000000000000000000000000000029dd45d38000000000000000000000000000000000000000000000000000000029e3fae5d000000000000000000000000000000000000000000000000000000029e3fae5d000000000000000000000000000000000000000000000000000000029e3fae5d000000000000000000000000000000000000000000000000000000029e69d76bf00000000000000000000000000000000000000000000000000000029f335d2d000000000000000000000000000000000000000000000000000000029f8dea5400000000000000000000000000000000000000000000000000000002a03993a400000000000000000000000000000000000000000000000000000000000000006bb560aceed6dce5af3d96e3dc90f096e4a9f7fed874d1a23fee9296b837ab7d619765a94192752f4fb07f0e8c4ea61af840e7a6b505062fd2c8284fde40ea5f4adb1808b8e4a93f27c37fd6b11e50f485e3e15faec85b7c7cbcea25fb43ae2c63784625fc81c0ac55e9b0d2ab0de7b69f2c7354bf1527423ab3536d18afd180dad464ddfa3042483a4abf130a93bae717c0724b7a9ee743a792985e61177aa9fa20aebc667b97021baa4d30adab129eb9d4f3e3fa44236f4903c0004ac708c8a00000000000000000000000000000000000000000000000000000000000000062bd80b02e9a74045b4fabc12924d67613ed4c65de1f1c21175fc6be8862eec62294f5d98690c8d7b2c0cc1e025b3c78bd1bd34d863f5c95cc4441d79e35e25a22f52081ffb512e463171120b37c08c57183517c6c077a447adc3409277e6f2ed34b306eabcc2ba588e68a8905d5b6be5c7da96053be010d5f055d76ee4e1c90d50f29b6e00fd7191c85b952dc1fe7d238236a626411434d61de14f52bced934938829b4423eba19a14697bedb57651b0114681d15bc846e8d55826213cebf6468193a0a4a1978e3414253462dc559d64e6a2f00ae0cd7733cd9f5cf3288419b4f95b83a07efc6a62e491cd3bb33f6153fc8a0423a347ef001d9a33383a88e46d97ccffad', '0xf9016a1784b2d05e00832dc6c09457aba600c3880d73b42b1197b90224ba8e1e0c5a80b9010418de05240000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000005b63613fade3fd4e4000000000000000000000000531febfeb9a61d948c384acfbe6dcc51057aea7e0000000000000000000000002170ed0880ac9a755fd29b2688956bd959f933f800000000000000000000000055d398326f99059ff775485246999027b3197955000000000000000000000000d956dd349bb158b390e6bc4abd73faebd8194708000000000000000000000000fd5840cd36d94d7229439859c0112a4185bc0255000000000000000000000000f508fcd89b8bd15579dc79a6827cb4686a3592c81ba07074b1bc7332f077c1df25e2c9e8cf2f2ccfcff1b6c12d12bff2f1523586bfa4a07b8af144b92517c182a183b2e500139e967bb881661651e6b82854e2c04f7fa1']
    res = bnb48.send_puissant(txs, int(time.time())-4, [])
    print(res)
